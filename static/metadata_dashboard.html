<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metadata Catalog - API Tester</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 12px 12px 0 0;
        }

        .section {
            padding: 30px;
            border-bottom: 1px solid #e2e8f0;
        }

        .section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 1.5em;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 20px;
        }

        .test-group {
            background: #f9fafb;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .test-title {
            font-weight: 600;
            color: #374151;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 10px;
        }

        .form-row label {
            min-width: 120px;
            font-weight: 600;
            color: #374151;
        }

        .input-field {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            min-width: 200px;
        }

        .input-field:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            margin-right: 10px;
        }

        .btn-primary {
            background: #4f46e5;
            color: white;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .response-box {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .response-success {
            background: #d1fae5;
            border: 1px solid #10b981;
            color: #065f46;
        }

        .response-error {
            background: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
        }

        .status {
            padding: 8px 12px;
            border-radius: 4px;
            margin-top: 10px;
            font-weight: 600;
        }

        .status-success {
            background: #d1fae5;
            color: #065f46;
        }

        .status-error {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 14px;
        }

        .data-table th {
            background: #f8fafc;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border: 1px solid #e2e8f0;
        }

        .data-table td {
            padding: 12px;
            border: 1px solid #e2e8f0;
            word-break: break-word;
        }

        .data-table tr:nth-child(even) {
            background: #f9fafb;
        }

        .clickable-row {
            cursor: pointer;
        }

        .clickable-row:hover {
            background: #e0f2fe !important;
        }

        .token-display {
            background: #f1f5f9;
            padding: 10px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 11px;
            word-break: break-all;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üóÇÔ∏è Metadata Catalog - API Tester</h1>
            <p>Test all your Phase 3.1 & 3.2 APIs step by step</p>
        </div>

        <!-- Authentication Section -->
        <div class="section">
            <div class="section-title">üîê Authentication</div>

            <div class="test-group">
                <div class="test-title">üìù Register New User</div>
                <div class="form-row">
                    <label>Username:</label>
                    <input type="text" id="regUsername" class="input-field" placeholder="your_username">
                </div>
                <div class="form-row">
                    <label>Email:</label>
                    <input type="email" id="regEmail" class="input-field" placeholder="user@example.com">
                </div>
                <div class="form-row">
                    <label>Password:</label>
                    <input type="password" id="regPassword" class="input-field" placeholder="password">
                </div>
                <button class="btn btn-primary" onclick="testRegister()">üöÄ Test Register</button>
                <div id="registerStatus" class="status" style="display: none;"></div>
            </div>

            <div class="test-group">
                <div class="test-title">üîë Login</div>
                <div class="form-row">
                    <label>Username:</label>
                    <input type="text" id="loginUsername" class="input-field" placeholder="mnm">
                </div>
                <div class="form-row">
                    <label>Password:</label>
                    <input type="password" id="loginPassword" class="input-field" placeholder="mnm">
                </div>
                <button class="btn btn-success" onclick="testLogin()">üîë Test Login</button>
                <button class="btn btn-primary" onclick="quickFillLogin()">Quick Fill</button>
                <div id="loginStatus" class="status" style="display: none;"></div>
                <div id="tokenDisplay" class="token-display"></div>
            </div>

            <div id="authResponse" class="response-box"></div>
        </div>

        <!-- Database Connections Section -->
        <div class="section">
            <div class="section-title">üîó Database Connections</div>

            <div class="test-group">
                <div class="test-title">‚ûï Create Connection</div>
                <div class="form-row">
                    <label>Host:</label>
                    <input type="text" id="dbHost" class="input-field" placeholder="cluster0.xxx.mongodb.net">
                </div>
                <div class="form-row">
                    <label>Port:</label>
                    <input type="number" id="dbPort" class="input-field" placeholder="27017 (optional)">
                </div>
                <div class="form-row">
                    <label>Username:</label>
                    <input type="text" id="dbUsername" class="input-field" placeholder="db_username">
                </div>
                <div class="form-row">
                    <label>Password:</label>
                    <input type="password" id="dbPassword" class="input-field" placeholder="db_password">
                </div>
                <div class="form-row">
                    <label>Database:</label>
                    <input type="text" id="dbDatabase" class="input-field" placeholder="database_name">
                </div>
                <button class="btn btn-success" onclick="testCreateConnection()">üîó Test Create</button>
                <button class="btn btn-primary" onclick="quickFillConnection()">Quick Fill</button>
                <div id="createConnectionStatus" class="status" style="display: none;"></div>
            </div>

            <div class="test-group">
                <div class="test-title">üìã List Connections</div>
                <button class="btn btn-primary" onclick="testListConnections()">üìã Test List</button>
                <div id="listConnectionsStatus" class="status" style="display: none;"></div>
            </div>

            <div id="connectionsResponse" class="response-box"></div>
            <div id="connectionsTable"></div>
        </div>

        <!-- Metadata Discovery Section -->
        <div class="section">
            <div class="section-title">üìä Metadata Discovery</div>

            <div class="test-group">
                <div class="test-title">üöÄ Discover Metadata</div>
                <div class="form-row">
                    <label>Connection ID:</label>
                    <input type="text" id="connectionId" class="input-field"
                        placeholder="Select from connections above">
                </div>
                <button class="btn btn-success" onclick="testDiscoverMetadata()">üöÄ Test Discovery</button>
                <div id="discoverStatus" class="status" style="display: none;"></div>
            </div>

            <div id="metadataResponse" class="response-box"></div>
            <div id="metadataTable"></div>
        </div>

        <!-- Metadata Enrichment Section -->
        <div class="section">
            <div class="section-title">‚ú® Metadata Enrichment (Phase 3.1)</div>

            <div class="test-group">
                <div class="test-title">üè¢ Enrich Collection</div>
                <div class="form-row">
                    <label>Metadata ID:</label>
                    <div class="form-row">
                        <label>Metadata ID:</label>
                        <select id="enrichMetadataId" class="input-field">
                            <option value="">Select Metadata</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <label>Description:</label>
                    <input type="text" id="collectionDesc" class="input-field" placeholder="Collection description">
                </div>
                <div class="form-row">
                    <label>Tags:</label>
                    <input type="text" id="collectionTags" class="input-field" placeholder="tag1, tag2, tag3">
                </div>
                <div class="form-row">
                    <label>Owner:</label>
                    <input type="text" id="collectionOwner" class="input-field" placeholder="owner@example.com">
                </div>
                <button class="btn btn-warning" onclick="testEnrichCollection()">‚ú® Test Enrich Collection</button>
                <div id="enrichCollectionStatus" class="status" style="display: none;"></div>
            </div>

            <div class="test-group">
                <div class="test-title">üîç Enrich Field</div>
                <div class="form-row">
                    <label>Metadata ID:</label>
                    <div class="form-row">
                        <label>Metadata ID:</label>
                        <select id="fieldMetadataId" class="input-field">
                            <option value="">Select Metadata</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <label>Field Name:</label>
                    <input type="text" id="fieldName" class="input-field" placeholder="email, username, etc.">
                </div>
                <div class="form-row">
                    <label>Description:</label>
                    <input type="text" id="fieldDesc" class="input-field" placeholder="Field description">
                </div>
                <div class="form-row">
                    <label>Tags:</label>
                    <input type="text" id="fieldTags" class="input-field" placeholder="pii, sensitive, etc.">
                </div>
                <button class="btn btn-warning" onclick="testEnrichField()">üîç Test Field Enrich</button>
                <div id="enrichFieldStatus" class="status" style="display: none;"></div>
            </div>

            <div id="enrichmentResponse" class="response-box"></div>
        </div>

        <!-- PII Detection Section -->
        <div class="section">
            <div class="section-title">ü§ñ Auto PII Detection (Phase 3.2)</div>

            <div class="test-group">
                <div class="test-title">üîç Auto-Detect PII Fields</div>
                <div class="form-row">
                    <label>Metadata ID:</label>
                    <div class="form-row">
                        <label>Metadata ID:</label>
                        <select id="piiMetadataId" class="input-field">
                            <option value="">Select Metadata</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-success" onclick="testAutoPII()">ü§ñ Test Auto PII Detection</button>
                <div id="autoPIIStatus" class="status" style="display: none;"></div>
            </div>

            <div id="piiResponse" class="response-box"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:8000';
        let authToken = '';
        let connections = [];
        let metadata = [];

        // Utility functions
        function showStatus(elementId, message, type = 'pending') {
            const statusDiv = document.getElementById(elementId);
            if (statusDiv) {
                statusDiv.style.display = 'block';
                statusDiv.className = `status status-${type}`;
                statusDiv.textContent = message;
            }
        }

        function showResponse(elementId, response, isError = false) {
            const responseBox = document.getElementById(elementId);
            if (responseBox) {
                responseBox.style.display = 'block';
                responseBox.className = `response-box ${isError ? 'response-error' : 'response-success'}`;
                responseBox.textContent = typeof response === 'object' ? JSON.stringify(response, null, 2) : response;
            }
        }

        // Quick fill functions
        function quickFillLogin() {
            document.getElementById('loginUsername').value = 'mnm';
            document.getElementById('loginPassword').value = 'mnm';
        }

        function quickFillConnection() {
            document.getElementById('dbHost').value = 'cluster0.todxcee.mongodb.net';
            document.getElementById('dbPort').value = '';
            document.getElementById('dbUsername').value = 'sauravkaushik';
            document.getElementById('dbPassword').value = 'iqlab2025';
            document.getElementById('dbDatabase').value = 'metadata_catalog';
        }

        // Authentication functions
        async function testRegister() {
            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;

            if (!username || !email || !password) {
                showResponse('authResponse', 'Please fill in all fields', true);
                return;
            }

            showStatus('registerStatus', 'Testing registration...', 'pending');

            try {
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    showStatus('registerStatus', 'Registration successful!', 'success');
                    showResponse('authResponse', data);
                } else {
                    showStatus('registerStatus', 'Registration failed', 'error');
                    showResponse('authResponse', data, true);
                }
            } catch (error) {
                showStatus('registerStatus', 'Registration error', 'error');
                showResponse('authResponse', error.message, true);
            }
        }

        async function testLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) {
                showResponse('authResponse', 'Please fill in username and password', true);
                return;
            }

            showStatus('loginStatus', 'Testing login...', 'pending');

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok) {
                    authToken = data.access_token;
                    showStatus('loginStatus', 'Login successful! Token received.', 'success');
                    showResponse('authResponse', data);

                    // Show token
                    const tokenDisplay = document.getElementById('tokenDisplay');
                    tokenDisplay.style.display = 'block';
                    tokenDisplay.innerHTML = `<strong>JWT Token:</strong><br>${authToken}`;
                } else {
                    showStatus('loginStatus', 'Login failed', 'error');
                    showResponse('authResponse', data, true);
                }
            } catch (error) {
                showStatus('loginStatus', 'Login error', 'error');
                showResponse('authResponse', error.message, true);
            }
        }

        // Database connection functions
        async function testCreateConnection() {
            if (!authToken) {
                showResponse('connectionsResponse', 'Please login first to get JWT token', true);
                return;
            }

            const host = document.getElementById('dbHost').value;
            const port = document.getElementById('dbPort').value;
            const username = document.getElementById('dbUsername').value;
            const password = document.getElementById('dbPassword').value;
            const database = document.getElementById('dbDatabase').value;

            if (!host || !username || !password || !database) {
                showResponse('connectionsResponse', 'Please fill in required fields', true);
                return;
            }

            showStatus('createConnectionStatus', 'Testing connection...', 'pending');

            try {
                const connectionData = { host, username, password, database };
                if (port) connectionData.port = parseInt(port);

                const response = await fetch(`${API_BASE}/db/connect`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(connectionData)
                });

                const data = await response.json();

                if (response.ok) {
                    showStatus('createConnectionStatus', 'Connection created successfully!', 'success');
                    showResponse('connectionsResponse', data);
                    testListConnections(); // Auto-refresh connections
                } else {
                    showStatus('createConnectionStatus', 'Connection failed', 'error');
                    showResponse('connectionsResponse', data, true);
                }
            } catch (error) {
                showStatus('createConnectionStatus', 'Connection error', 'error');
                showResponse('connectionsResponse', error.message, true);
            }
        }

        async function testListConnections() {
            if (!authToken) {
                showResponse('connectionsResponse', 'Please login first', true);
                return;
            }

            showStatus('listConnectionsStatus', 'Loading connections...', 'pending');

            try {
                const response = await fetch(`${API_BASE}/db/connections`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();

                if (response.ok) {
                    connections = data;
                    showStatus('listConnectionsStatus', `Found ${data.length} connections`, 'success');
                    showResponse('connectionsResponse', data);
                    displayConnectionsTable(data);
                } else {
                    showStatus('listConnectionsStatus', 'Failed to load connections', 'error');
                    showResponse('connectionsResponse', data, true);
                }
            } catch (error) {
                showStatus('listConnectionsStatus', 'Error loading connections', 'error');
                showResponse('connectionsResponse', error.message, true);
            }
        }

        function displayConnectionsTable(connections) {
            const container = document.getElementById('connectionsTable');

            if (connections.length === 0) {
                container.innerHTML = '<p>No connections found. Create one above!</p>';
                return;
            }

            let html = `
                <h3>üîó Your Database Connections</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Connection ID</th>
                            <th>Host</th>
                            <th>Database</th>
                            <th>Username</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            connections.forEach(conn => {
                html += `
                    <tr class="clickable-row" onclick="useForDiscovery('${conn.id}')">
                        <td><code>${conn.id}</code></td>
                        <td>${conn.host}</td>
                        <td>${conn.database}</td>
                        <td>${conn.username}</td>
                        <td>
                            <button class="btn btn-primary" onclick="useForDiscovery('${conn.id}')">Use for Discovery</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function useForDiscovery(connectionId) {
            document.getElementById('connectionId').value = connectionId;
            document.getElementById('connectionId').style.background = '#d1fae5';
        }

        // Metadata discovery
        async function testDiscoverMetadata() {
            if (!authToken) {
                showResponse('metadataResponse', 'Please login first', true);
                return;
            }

            const connectionId = document.getElementById('connectionId').value;
            if (!connectionId) {
                showResponse('metadataResponse', 'Please enter or select a connection ID', true);
                return;
            }

            showStatus('discoverStatus', 'Discovering metadata...', 'pending');

            try {
                const response = await fetch(`${API_BASE}/ingest/mongodb/${connectionId}`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();

                if (response.ok) {
                    metadata = data;
                    showStatus('discoverStatus', `Found ${data.length} collections`, 'success');
                    showResponse('metadataResponse', data);
                    displayMetadataTable(data);
                } else {
                    showStatus('discoverStatus', 'Discovery failed', 'error');
                    showResponse('metadataResponse', data, true);
                }
            } catch (error) {
                showStatus('discoverStatus', 'Discovery error', 'error');
                showResponse('metadataResponse', error.message, true);
            }
        }

        function displayMetadataTable(metadata) {
            const container = document.getElementById('metadataTable');

            let html = `
                <h3>üìä Discovered Metadata</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Metadata ID</th>
                            <th>Collection</th>
                            <th>Fields</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            metadata.forEach(meta => {
                const fieldsPreview = meta.fields.slice(0, 3).map(f => f.name).join(', ') +
                    (meta.fields.length > 3 ? '...' : '');

                html += `
                    <tr class="clickable-row">
                        <td><code>${meta.id}</code></td>
                        <td><strong>${meta.collection}</strong></td>
                        <td>${fieldsPreview}</td>
                        <td>
                            <button class="btn btn-warning" onclick="useForEnrichment('${meta.id}')">Use for Enrichment</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
            // ‚úÖ Populate Metadata ID dropdowns in enrichment & PII sections
            ['enrichMetadataId', 'fieldMetadataId', 'piiMetadataId'].forEach(id => {
                const sel = document.getElementById(id);
                if (sel) {
                    sel.innerHTML = '<option value="">Select Metadata</option>' +
                        metadata.map(m => `<option value="${m.id}">${m.id} (${m.collection})</option>`).join('');
                }
            });

        }

        function useForEnrichment(metadataId) {
            document.getElementById('enrichMetadataId').value = metadataId;
            document.getElementById('fieldMetadataId').value = metadataId;
            document.getElementById('piiMetadataId').value = metadataId;

            // Highlight the fields
            ['enrichMetadataId', 'fieldMetadataId', 'piiMetadataId'].forEach(id => {
                const field = document.getElementById(id);
                if (field) field.style.background = '#d1fae5';
            });
        }

        // Enrichment functions
        async function testEnrichCollection() {
            if (!authToken) {
                showResponse('enrichmentResponse', 'Please login first', true);
                return;
            }

            const metadataId = document.getElementById('enrichMetadataId').value;
            const description = document.getElementById('collectionDesc').value;
            const tags = document.getElementById('collectionTags').value;
            const owner = document.getElementById('collectionOwner').value;

            if (!metadataId) {
                showResponse('enrichmentResponse', 'Please enter metadata ID', true);
                return;
            }

            showStatus('enrichCollectionStatus', 'Enriching collection...', 'pending');

            try {
                const enrichmentData = {};
                if (description) enrichmentData.description = description;
                if (tags) enrichmentData.tags = tags.split(',').map(t => t.trim());
                if (owner) enrichmentData.owner = owner;

                const response = await fetch(`${API_BASE}/metadata/${metadataId}/collection`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(enrichmentData)
                });

                const data = await response.json();

                if (response.ok) {
                    showStatus('enrichCollectionStatus', 'Collection enriched successfully!', 'success');
                    showResponse('enrichmentResponse', data);
                } else {
                    showStatus('enrichCollectionStatus', 'Enrichment failed', 'error');
                    showResponse('enrichmentResponse', data, true);
                }
            } catch (error) {
                showStatus('enrichCollectionStatus', 'Enrichment error', 'error');
                showResponse('enrichmentResponse', error.message, true);
            }
        }

        async function testEnrichField() {
            if (!authToken) {
                showResponse('enrichmentResponse', 'Please login first', true);
                return;
            }

            const metadataId = document.getElementById('fieldMetadataId').value;
            const fieldName = document.getElementById('fieldName').value;
            const description = document.getElementById('fieldDesc').value;
            const tags = document.getElementById('fieldTags').value;

            if (!metadataId || !fieldName) {
                showResponse('enrichmentResponse', 'Please enter metadata ID and field name', true);
                return;
            }

            showStatus('enrichFieldStatus', 'Enriching field...', 'pending');

            try {
                const enrichmentData = {};
                if (description) enrichmentData.description = description;
                if (tags) enrichmentData.tags = tags.split(',').map(t => t.trim());

                const response = await fetch(`${API_BASE}/metadata/${metadataId}/field/${fieldName}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(enrichmentData)
                });

                const data = await response.json();

                if (response.ok) {
                    showStatus('enrichFieldStatus', 'Field enriched successfully!', 'success');
                    showResponse('enrichmentResponse', data);
                } else {
                    showStatus('enrichFieldStatus', 'Field enrichment failed', 'error');
                    showResponse('enrichmentResponse', data, true);
                }
            } catch (error) {
                showStatus('enrichFieldStatus', 'Field enrichment error', 'error');
                showResponse('enrichmentResponse', error.message, true);
            }
        }

        async function testAutoPII() {
            if (!authToken) {
                showResponse('piiResponse', 'Please login first', true);
                return;
            }

            const metadataId = document.getElementById('piiMetadataId').value;
            if (!metadataId) {
                showResponse('piiResponse', 'Please enter metadata ID', true);
                return;
            }

            showStatus('autoPIIStatus', 'Analyzing PII fields...', 'pending');

            try {
                const response = await fetch(`${API_BASE}/metadata/${metadataId}/auto-pii`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();

                if (response.ok) {
                    showStatus('autoPIIStatus', 'PII analysis completed!', 'success');
                    showResponse('piiResponse', data);
                } else {
                    showStatus('autoPIIStatus', 'PII analysis failed', 'error');
                    showResponse('piiResponse', data, true);
                }
            } catch (error) {
                showStatus('autoPIIStatus', 'PII analysis error', 'error');
                showResponse('piiResponse', error.message, true);
            }
        }
    </script>
</body>

</html>